[{"title":"è°ƒè¯• LeetCode ä¹‹ â€œä¸€é”®è¡¥å…¨å¤´æ–‡ä»¶â€ è¶…ç®€æ•™ç¨‹","url":"/2026/01/22/debug-leetcode-auto-include/","content":"\næœ¬æ–‡ 100% äº²æµ‹æœ‰æ•ˆï¼Œ3 æ­¥è§£å†³ #include &lt;bits&#x2F;stdc++.h&gt; æ ‡çº¢ã€commoncppproblem2.h æ‰¾ä¸åˆ°ç­‰ IDE çƒ¦æ¼ã€‚  \n\n\n\n\nâœ¨ å‰ç½®å‡†å¤‡\nå®‰è£… Leetcode  \nç™»å½•ä½¿ç”¨ä¸å¤šèµ˜è¿°ã€‚\n\n\nä¸‹è½½ã€ŒDebug LeetCodeã€æ’ä»¶  \nå•†åº—æœç´¢ Debug LeetCodeï¼Œç‚¹å‡» Installã€‚  \næˆåŠŸåä¼šåœ¨ä¾§è¾¹æ çœ‹åˆ°ä¸€ä¸ª ğŸ’¡ çš„ LeetCode å›¾æ ‡ã€‚\n\n\n\n\nè‹¥ä½ å°šæœªé…ç½®æœ¬åœ° C&#x2F;C++ ç¯å¢ƒï¼Œå¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£ è¿›è¡Œ GCC&#x2F;Clang å®‰è£…ä¸ C/C++ æ‰©å±•é…ç½®ã€‚\n\n\nğŸš€ ä¸‰æ­¥æå®šè‡ªåŠ¨è¡¥å…¨å¤´æ–‡ä»¶\n\n\næ­¥éª¤\næ“ä½œ\næˆªå›¾\n\n\n\nStep&nbsp;1\næ‰“å¼€ä»»æ„ LeetCode é¢˜ç›®ï¼Œç‚¹å‡»é¡¶éƒ¨çš„ Debug æŒ‰é’®\n\n\n\nStep&nbsp;2\né¦–æ¬¡è¿è¡Œæ—¶æ’ä»¶ä¼š è‡ªåŠ¨ç”Ÿæˆ main.cppï¼Œå¹¶æŠŠç¼ºå¤±çš„ç³»ç»Ÿå¤´æ–‡ä»¶ä¸€æ¬¡æ€§è¡¥é½\n\n\n\nStep&nbsp;3\nè‹¥ä»å‡ºç° #include &quot;commoncppproblem2.h&quot; çš„çº¢è‰²æ³¢æµªçº¿ â€”â€” æ·»åŠ  include path å³å¯\n\n\n\nå¦‚ä½•æ·»åŠ  include pathï¼Ÿ\næ‰“å¼€å‘½ä»¤é¢æ¿ Ctrl+Shift+P â†’ è¾“å…¥å¹¶é€‰æ‹© C&#x2F;C++: Edit Configurations (UI)  \nåœ¨ Include path ä¸­è¿½åŠ ä¸‹åˆ—ç›®å½•ï¼ˆæ›¿æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åï¼‰ï¼š\n\nC:\\Users\\&lt;YourUserName&gt;\\AppData\\Roaming\\Code\\User\\globalStorage\\wangtao0101.debug-leetcode\n\n\nè‡³æ­¤ï¼Œè°ƒè¯•ç¯å¢ƒå®Œç¾å¯ç”¨ï¼  \n","categories":["åˆ·é¢˜"],"tags":["LeetCode","VSCode","C++"]},{"title":"Goæ ‡å‡†åº“ä¸­çš„contextåŒ…","url":"/2026/01/23/go-context/","content":"æœ¬æ–‡æ€»ç»“äº† Go æ ‡å‡†åº“ä¸­ context çš„å¸¸è§ç”¨æ³•ï¼ŒåŒ…æ‹¬åˆ›å»ºã€ä¼ é€’ã€å–æ¶ˆã€è¶…æ—¶éƒ¨åˆ†åœºæ™¯ã€‚\n\n\n1.contextåŒ…è´Ÿè´£Goå½“ä¸­çš„ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶1.1 é—®é¢˜åœºæ™¯\nä¸€ä¸ª HTTP è¯·æ±‚å¯èƒ½å¯åŠ¨å¤šä¸ª goroutineï¼ˆè°ƒç”¨ä¸‹æ¸¸æœåŠ¡ã€æŸ¥æ•°æ®åº“ã€å†™æ—¥å¿—ï¼‰\nå¦‚æœå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œéœ€è¦å–æ¶ˆæ‰€æœ‰ç›¸å…³æ“ä½œï¼Œé¿å…æµªè´¹èµ„æº\nå¦‚æœæŸä¸ªæ“ä½œè¶…æ—¶ï¼Œéœ€è¦åŠæ—¶åœæ­¢ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…\n\n1.2 ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜\næ²¡æœ‰ç»Ÿä¸€çš„å–æ¶ˆæœºåˆ¶ï¼Œæ¯ä¸ª goroutine éœ€è¦è‡ªå·±ç®¡ç†åœæ­¢é€»è¾‘\néš¾ä»¥åœ¨è°ƒç”¨é“¾ä¸­ä¼ é€’å–æ¶ˆä¿¡å·\n\n1.3 context çš„ä»·å€¼\nç»Ÿä¸€å–æ¶ˆæœºåˆ¶ï¼šä¸€ä¸ª ctx.Done() å¯ä»¥é€šçŸ¥æ‰€æœ‰ç›¸å…³ goroutine\nè‡ªåŠ¨ä¼ æ’­ï¼šå­ context ä¼šç»§æ‰¿çˆ¶ context çš„å–æ¶ˆçŠ¶æ€\nè¶…æ—¶æ§åˆ¶ï¼šå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè‡ªåŠ¨å–æ¶ˆ\n\n2.contextçš„æ¥å£å®ç°// ä¸»è¦åŒ…å«å››ä¸ªæ–¹æ³•type Context interface &#123;  Deadline() (deadline time.Time, ok bool)  // è·å–æˆªæ­¢æ—¶é—´  Done() &lt;-chan struct&#123;&#125;                   // ä¸€ä¸ªåªè¯»çš„channelï¼Œè¡¨ç¤ºå½“å‰contextæ˜¯å¦è¢«å–æ¶ˆ  Err() error                              // è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯  Value(key any) any                       // æœ€åä¸€ä¸ªåˆ™æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ å­˜å‚¨æ•°æ®&#125;\n\n3.contextçš„åˆ›å»ºctx1 := context.Background()ctx2 := context.TODO()// ä¸¤è€…éƒ½ä¸ä¼šè¢«å–æ¶ˆ&lt;-ctx1.Done() // æ°¸è¿œé˜»å¡&lt;-ctx2.Done() // æ°¸è¿œé˜»å¡// ä¸¤è€…åªæœ‰è¯­ä¹‰ä¸Šæœ‰å·®åˆ«// Background()ï¼šä½œä¸ºæ ¹ contextï¼Œç”¨äºç¨‹åºå…¥å£ã€æµ‹è¯•ã€é¡¶å±‚é€»è¾‘// TODO(): ä¸ç¡®å®šè¯¥ç”¨å“ªä¸ª context æ—¶çš„å ä½ç¬¦ï¼Œè¡¨ç¤ºâ€œè¿™é‡Œéœ€è¦ contextï¼Œä½†æˆ‘æš‚æ—¶ä¸ç¡®å®šè¯¥ä¼ ä»€ä¹ˆâ€\n\n4.contextçš„ä¼ é€’æœºåˆ¶4.1 çˆ¶å­ç»§æ‰¿func main() &#123;  ctx1 := context.TODO()  ctx2 := context.Background() // åªæœ‰è¯­ä¹‰ä¸Šæœ‰å·®åˆ« éƒ½æ˜¯åˆ›å»º  ctx1 = context.WithValue(ctx1, &quot;name&quot;, &quot;father&quot;) // ä»ç©ºçš„ctx1ç»§æ‰¿ +[name]:[father]é”®å€¼å¯¹  ctx1 = context.WithValue(ctx2, &quot;age&quot;, 18)        // ä»ç©ºçš„ctx2åŠ ä¸Š[age]:18  fmt.Println(ctx1.Value(&quot;name&quot;), ctx1.Value(&quot;age&quot;))  fmt.Println(ctx2.Value(&quot;name&quot;), ctx2.Value(&quot;age&quot;))&#125;// æ‰€ä»¥æˆ‘åªèƒ½çŸ¥é“ctx1çš„age// nameåœ¨ä¼ é€’è¿‡ç¨‹ä¸­æ¶ˆå¤±\n\n\n\nfunc main() &#123;  ctx1 := context.TODO()  ctx2 := context.Background() // åªæœ‰è¯­ä¹‰ä¸Šæœ‰å·®åˆ« éƒ½æ˜¯åˆ›å»º  ctx1 = context.WithValue(ctx1, &quot;name&quot;, &quot;father&quot;) // ä»ç©ºçš„ctx1ç»§æ‰¿ +[name]:[father]é”®å€¼å¯¹  ctx1 = context.WithValue(ctx1, &quot;age&quot;, 18)        // ä»ctx1çš„[name]:[father]åŠ ä¸Š[age]:18  fmt.Println(ctx1.Value(&quot;name&quot;), ctx1.Value(&quot;age&quot;))  fmt.Println(ctx2.Value(&quot;name&quot;), ctx2.Value(&quot;age&quot;))&#125;// è¿™æ—¶å€™nameä¹Ÿè¢«ä¼ é€’ä¸‹æ¥// ctx2ä¾æ—§æ˜¯ç©ºçš„\n\n\n\n4.2 æ›´åŠ ç›´è§‚çš„çˆ¶å­ç»§æ‰¿func main() &#123;  ctx1 := context.TODO()  ctx2 := context.Background()  ctx1 = context.WithValue(ctx1, &quot;name&quot;, &quot;father&quot;)  ctx2 = context.WithValue(ctx1, &quot;name&quot;, &quot;son&quot;)  fmt.Println(ctx1.Value(&quot;name&quot;))  fmt.Println(ctx2.Value(&quot;name&quot;))&#125;\n\n\n\n5.contextçš„å–æ¶ˆæœºåˆ¶context.WithCancel å‡½æ•°èƒ½å¤Ÿä» context.Context ä¸­è¡ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­ä¸Šä¸‹æ–‡å¹¶è¿”å›ç”¨äºå–æ¶ˆè¯¥ä¸Šä¸‹æ–‡çš„å‡½æ•°ã€‚\nä¸€æ—¦æˆ‘ä»¬æ‰§è¡Œè¿”å›çš„å–æ¶ˆå‡½æ•°ï¼Œå½“å‰ä¸Šä¸‹æ–‡ä»¥åŠå®ƒçš„å­ä¸Šä¸‹æ–‡éƒ½ä¼šè¢«å–æ¶ˆï¼Œæ‰€æœ‰çš„ Goroutine éƒ½ä¼šåŒæ­¥æ”¶åˆ°è¿™ä¸€å–æ¶ˆä¿¡å·ã€‚\nå…ˆæ¥ä¸ªç®€å•çš„ demo å±•ç¤ºï¼š\nfunc work(ctx context.Context) &#123;  for &#123;    select &#123;    case &lt;-ctx.Done():      fmt.Println(&quot;ctx done&quot;)      return    default:      fmt.Println(&quot;working&quot;)      time.Sleep(1 * time.Second)    &#125;  &#125;&#125;func main() &#123;  ctx, cancel := context.WithCancel(context.Background())  go func() &#123;    time.Sleep(5 * time.Second)    cancel()  &#125;()  work(ctx)&#125;\n\n\n\näº”ç§’ working ä¹‹å done ç¬¦åˆé¢„æœŸã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ä¸ºä»€ä¹ˆè°ƒç”¨å–æ¶ˆä¹‹å ctx.Done() å°±ä¼šäº§ç”Ÿè¿”å›å€¼å‘¢ï¼Œè¿™è·Ÿ golang çš„ channel ç‰¹æ€§æœ‰å…³ï¼šå½“ä»ä¸€ä¸ªå…³é—­çš„ channel è¯»å–æ—¶ä¼šè¯»å–â€œé›¶å€¼â€ï¼Œæ‰€ä»¥èƒ½å¤Ÿè¯»å–åˆ°æ•°æ®ã€‚\n6.contextçš„æˆªæ­¢æ—¶é—´æœºåˆ¶func main() &#123;  ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(5*time.Second))  defer cancel()  select &#123;  case &lt;-time.After(8 * time.Second):    fmt.Println(&quot;ä»»åŠ¡æ‰§è¡Œå®Œæˆ&quot;)  case &lt;-ctx.Done():    fmt.Println(&quot;ä»»åŠ¡è¢«å–æ¶ˆ:&quot;, ctx.Err())  &#125;&#125;\n\n\n\nDeadline æ›´é€‚åˆ æ•´ä¸ªå·¥ä½œæµç¨‹ çš„æˆªæ­¢æ—¶é—´ï¼ˆå¦‚æ‰¹å¤„ç†ä»»åŠ¡å¿…é¡»åœ¨åˆå¤œå‰å®Œæˆã€å¿…é¡»åœ¨äº‹åŠ¡å¼€å§‹ 30 å¤šç§’ä¹‹åæäº¤ï¼‰ã€‚\n7.contextçš„è¶…æ—¶æœºåˆ¶ä»¥åŠç»§æ‰¿å…³ç³»å½“ä¸€ä¸ª Context è®¾ç½®è¶…æ—¶åï¼Œå®ƒä¼šåˆ›å»º ä¸€ä¸ªæ–°çš„ Context èŠ‚ç‚¹ åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­ï¼Œè¶…æ—¶æ—¶é—´ä¼š å‘ä¸‹ä¼ æ’­ç»™æ‰€æœ‰å­ä¸Šä¸‹æ–‡ã€‚\nè§„åˆ™1ï¼šå­ä¸Šä¸‹æ–‡ä¸èƒ½å»¶é•¿çˆ¶ä¸Šä¸‹æ–‡çš„è¶…æ—¶func main() &#123;  // æ ¹ä¸Šä¸‹æ–‡ï¼Œæ²¡æœ‰è¶…æ—¶  rootCtx := context.Background()  // åˆ›å»º 5 ç§’è¶…æ—¶çš„çˆ¶ä¸Šä¸‹æ–‡  parentCtx, parentCancel := context.WithTimeout(rootCtx, 5*time.Second)  defer parentCancel()  // åˆ›å»ºå­ä¸Šä¸‹æ–‡ï¼ˆç»§æ‰¿çˆ¶çš„è¶…æ—¶ï¼‰  childCtx, childCancel := context.WithTimeout(parentCtx, 10*time.Second)  defer childCancel()  // æ£€æŸ¥è¶…æ—¶æ—¶é—´  checkDeadline(parentCtx, &quot;parent&quot;)  checkDeadline(childCtx, &quot;child&quot;)&#125;func checkDeadline(ctx context.Context, name string) &#123;  deadline, ok := ctx.Deadline()  if ok &#123;    remaining := time.Until(deadline)    fmt.Printf(&quot;%s: æˆªæ­¢æ—¶é—´ %v, å‰©ä½™ %v\\n&quot;,      name, deadline.Format(&quot;15:04:05&quot;), remaining)  &#125;&#125;\n\n\n\nè§„åˆ™2ï¼šå­ä¸Šä¸‹æ–‡å¯ä»¥è®¾ç½®æ›´çŸ­çš„è¶…æ—¶func main() &#123;  // æ ¹ä¸Šä¸‹æ–‡ï¼Œæ²¡æœ‰è¶…æ—¶  rootCtx := context.Background()  // åˆ›å»º 5 ç§’è¶…æ—¶çš„çˆ¶ä¸Šä¸‹æ–‡  parentCtx, parentCancel := context.WithTimeout(rootCtx, 5*time.Second)  defer parentCancel()  // åˆ›å»ºå­ä¸Šä¸‹æ–‡ï¼ˆç»§æ‰¿çˆ¶çš„è¶…æ—¶ï¼‰  childCtx, childCancel := context.WithTimeout(parentCtx, 2*time.Second)  defer childCancel()  // æ£€æŸ¥è¶…æ—¶æ—¶é—´  checkDeadline(parentCtx, &quot;parent&quot;)  checkDeadline(childCtx, &quot;child&quot;)&#125;func checkDeadline(ctx context.Context, name string) &#123;  deadline, ok := ctx.Deadline()  if ok &#123;    remaining := time.Until(deadline)    fmt.Printf(&quot;%s: æˆªæ­¢æ—¶é—´ %v, å‰©ä½™ %v\\n&quot;,      name, deadline.Format(&quot;15:04:05&quot;), remaining)  &#125;&#125;\n\n\n\nå½“æˆ‘ä»¬åœ¨ http è¯·æ±‚é“¾å½“ä¸­å°±å¯ä»¥è®¾ç½®åˆ†å±‚ä¸¥æ ¼çš„è¯·æ±‚æ—¶é—´ã€‚\n","categories":["Go"],"tags":["Go","æ ‡å‡†åº“","context"]},{"title":"Go é‡Œçš„ recoverï¼šå¦‚ä½•ä¼˜é›…åœ°å…œåº• panicï¼ˆå†™ç»™åˆå­¦è€…ï¼‰","url":"/2026/01/27/go-recover/","content":"å¾ˆå¤š Go åˆå­¦è€…ç¬¬ä¸€æ¬¡é‡åˆ° panic éƒ½ä¼šå¾ˆæ…Œï¼šç¨‹åºç›´æ¥å´©äº†ï¼Œé”™è¯¯ä¿¡æ¯ä¸€å¤§å †ã€‚äºæ˜¯å°±ä¼šå¬åˆ°ä¸€å¥è¯ï¼šç”¨ recover å¯ä»¥æ•‘å›æ¥ã€‚\nä½† recover å¹¶ä¸æ˜¯â€œå“ªé‡Œéƒ½èƒ½ç”¨â€çš„ä¸‡èƒ½è¯ï¼Œå®ƒæœ‰éå¸¸æ˜ç¡®çš„è§¦å‘æ¡ä»¶å’Œè¾¹ç•Œã€‚æœ¬æ–‡ç”¨æœ€å°ç¤ºä¾‹æŠŠ panic / defer / recover çš„å…³ç³»è®²æ¸…æ¥šï¼Œå¹¶åˆ—å‡ºå¸¸è§å‘å’Œå·¥ç¨‹é‡Œæ­£ç¡®çš„å…œåº•æ–¹å¼ã€‚\n\n\n1. panic &#x2F; defer &#x2F; recover åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ\npanic\n\nè®©å½“å‰ goroutine è¿›å…¥å¼‚å¸¸æµç¨‹ï¼šä»å½“å‰å‡½æ•°å¼€å§‹å‘ä¸Šâ€œå±•å¼€è°ƒç”¨æ ˆâ€ï¼ˆstack unwindingï¼‰\nåœ¨å±•å¼€è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œæ¯ä¸€å±‚å‡½æ•°é‡Œæ³¨å†Œçš„ defer\n\n\ndefer\n\nå»¶è¿Ÿæ‰§è¡Œï¼šå‡½æ•°è¿”å›å‰æ‰§è¡Œ\nå‘ç”Ÿ panic æ—¶ä¹Ÿä¼šæ‰§è¡Œï¼ˆè¿™æ˜¯ recover èƒ½å·¥ä½œçš„åŸå› ï¼‰\n\n\nrecover\n\nä½œç”¨ï¼šåœ¨ panic å‘ç”Ÿåï¼ŒæŠŠ panic çš„å€¼å–å‡ºæ¥ï¼Œå¹¶é˜»æ­¢ç¨‹åºç»§ç»­å´©æºƒ\nåªèƒ½åœ¨ defer è°ƒç”¨çš„å‡½æ•°é‡Œç”Ÿæ•ˆï¼Œå¦åˆ™è¿”å› nil\n\n\n\nä¸€å¥è¯æ€»ç»“ï¼španic è§¦å‘å¼‚å¸¸ -&gt; defer ä»ä¼šæ‰§è¡Œ -&gt; defer é‡Œè°ƒç”¨ recover æ‰èƒ½æ•è·å¹¶å…œåº•ã€‚\n2. æœ€å°å¯è¿è¡Œç¤ºä¾‹ï¼šrecover æ­£ç¡®å†™æ³•package mainimport &quot;fmt&quot;func main() &#123;\tdefer func() &#123;\t\tif r := recover(); r != nil &#123;\t\t\tfmt.Println(&quot;æ•è·åˆ° panic:&quot;, r)\t\t&#125;\t&#125;()\tfmt.Println(&quot;before panic&quot;)\tpanic(&quot;something bad happened&quot;)\tfmt.Println(&quot;after panic (ä¸ä¼šæ‰§è¡Œ)&quot;)&#125;\n\nè¿è¡Œè¾“å‡ºç±»ä¼¼ï¼š\n\nbefore panic\næ•è·åˆ° panic: something bad happened\n\næ³¨æ„ï¼španic ä¹‹åçš„é‚£è¡Œ after panic ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºæ§åˆ¶æµå·²ç»è¿›å…¥ panic å±•å¼€æµç¨‹äº†ã€‚\n3. å¸¸è§è¯¯åŒº 1ï¼šä¸åœ¨ defer é‡Œè°ƒç”¨ recover â€”â€” æ°¸è¿œæŠ“ä¸åˆ°å¾ˆå¤šäººä¼šå†™æˆè¿™æ ·ï¼š\nrecover() // æ²¡ç”¨panic(&quot;x&quot;)\n\næˆ–è€…è¿™æ ·ï¼š\nfunc f() &#123;\tr := recover() // æ²¡ç”¨\tfmt.Println(r)\tpanic(&quot;x&quot;)&#125;\n\nåŸå› ï¼šrecover å¿…é¡»åœ¨ panic å±•å¼€è¿‡ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œè€Œå±•å¼€è¿‡ç¨‹åªä¼šæ‰§è¡Œ deferï¼Œæ‰€ä»¥å¿…é¡»å†™åœ¨ defer func(){...}() é‡Œã€‚\n4. å¸¸è§è¯¯åŒº 2ï¼šrecover åªèƒ½æŠ“â€œåŒä¸€ä¸ª goroutineâ€çš„ panicä¸‹é¢è¿™ç§æƒ…å†µéå¸¸å¸¸è§ï¼š\npackage mainimport (\t&quot;fmt&quot;\t&quot;time&quot;)func main() &#123;\tdefer func() &#123;\t\tif r := recover(); r != nil &#123;\t\t\tfmt.Println(&quot;main recover:&quot;, r)\t\t&#125;\t&#125;()\tgo func() &#123;\t\tpanic(&quot;panic in goroutine&quot;)\t&#125;()\ttime.Sleep(time.Second)\tfmt.Println(&quot;main exit&quot;)&#125;\n\nmain çš„ recover æŠ“ä¸åˆ°å­ goroutine çš„ panicã€‚å­ goroutine panic ä¼šç›´æ¥æŠŠæ•´ä¸ªè¿›ç¨‹æ‰“æŒ‚ï¼ˆå¦‚æœæ²¡äººå…œåº•ï¼‰ã€‚\næ­£ç¡®æ–¹å¼ï¼šåœ¨æ¯ä¸ª goroutine çš„å…¥å£å¤„å…œåº•ï¼š\ngo func() &#123;\tdefer func() &#123;\t\tif r := recover(); r != nil &#123;\t\t\tfmt.Println(&quot;goroutine recover:&quot;, r)\t\t&#125;\t&#125;()\tpanic(&quot;panic in goroutine&quot;)&#125;()\n\n5. å¸¸è§è¯¯åŒº 3ï¼šrecover åä¸æ˜¯â€œä» panic é‚£è¡Œç»§ç»­å¾€ä¸‹è·‘â€recover åªæ˜¯æŠŠ panic æˆªä½ï¼Œè®©ç¨‹åºä¸è‡³äºå´©æºƒã€‚\nä½†å®ƒå¹¶ä¸ä¼šè®©å‡½æ•°å›åˆ° panic() é‚£ä¸€è¡Œç»§ç»­æ‰§è¡Œï¼›panic æ‰€åœ¨å‡½æ•°ä¼šèµ°â€œè¿”å›è·¯å¾„â€ï¼Œç›¸å½“äºæå‰ç»“æŸäº†å½“å‰æ‰§è¡Œæµã€‚\næ‰€ä»¥ recover æ›´åƒï¼š\n\nå…œåº• + æ”¶å°¾ + è®°å½• + è¿”å›é»˜è®¤å€¼&#x2F;é”™è¯¯\n\nè€Œä¸æ˜¯ï¼š\n\nå¼‚å¸¸å‘ç”Ÿäº†ï¼Œä½†å½“ä½œæ²¡å‘ç”Ÿä¸€æ ·ç»§ç»­è·‘\n\n6. recover åˆ°åº•è¯¥æ€ä¹ˆç”¨æ‰åˆç†ï¼Ÿ6.1 å»ºè®®åªåœ¨â€œè¾¹ç•Œå±‚â€å…œåº•ï¼ˆæ¡†æ¶&#x2F;å…¥å£ï¼‰æ¯”å¦‚ï¼š\n\nHTTP handler çš„æœ€å¤–å±‚\næ¶ˆè´¹é˜Ÿåˆ—&#x2F;å®šæ—¶ä»»åŠ¡ worker çš„æœ€å¤–å±‚\ngoroutine çš„å…¥å£å‡½æ•°\n\nåŸå› ï¼š\n\npanic å¾€å¾€ä»£è¡¨ç¨‹åºå‘˜é”™è¯¯æˆ–ä¸å˜å¼è¢«ç ´å\nåœ¨ä¸šåŠ¡é€»è¾‘é‡Œç”¨ recover æŠŠ panic åæ‰ï¼Œä¼šéšè—é—®é¢˜ï¼Œå¯¼è‡´â€œæ‚„æ‚„é”™äº†ä½†æ²¡æŠ¥è­¦â€\n\n6.2 å…œåº•æ—¶åº”è¯¥åšä»€ä¹ˆï¼Ÿè‡³å°‘åšä¸‰ä»¶äº‹ï¼š\n\nè®°å½• panic çš„å€¼\nè®°å½•å †æ ˆï¼ˆéå¸¸é‡è¦ï¼‰\nè®©è°ƒç”¨æ–¹å¾—åˆ°åˆç†å“åº”ï¼ˆè¿”å›é”™è¯¯&#x2F;é»˜è®¤å€¼&#x2F;500ï¼‰\n\nä¸‹é¢æ˜¯ä¸€ä¸ªé€šç”¨çš„ recover åŒ…è£…å‡½æ•°ï¼ˆç¤ºä¾‹ï¼‰ï¼š\npackage mainimport (\t&quot;fmt&quot;\t&quot;runtime/debug&quot;)func safeGo(fn func()) &#123;\tgo func() &#123;\t\tdefer func() &#123;\t\t\tif r := recover(); r != nil &#123;\t\t\t\tfmt.Printf(&quot;panic: %v\\nstack:\\n%s\\n&quot;, r, debug.Stack())\t\t\t&#125;\t\t&#125;()\t\tfn()\t&#125;()&#125;func main() &#123;\tsafeGo(func() &#123;\t\tpanic(&quot;boom&quot;)\t&#125;)\tselect &#123;&#125;&#125;\n\n7. panic å’Œ error æ€ä¹ˆé€‰ï¼Ÿï¼ˆç»™åˆå­¦è€…çš„ç®€å•è§„åˆ™ï¼‰\nç”¨ errorï¼šå¯é¢„æœŸçš„å¤±è´¥ï¼ˆå‚æ•°ä¸åˆæ³•ã€ç½‘ç»œè¶…æ—¶ã€æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ï¼‰\nç”¨ panicï¼šä¸å¯æ¢å¤çš„ç¨‹åºé”™è¯¯&#x2F;ä¸å˜å¼ç ´åï¼ˆæ•°ç»„è¶Šç•Œã€ç©ºæŒ‡é’ˆã€å¹¶å‘å†™ mapã€é€»è¾‘å¿…ç„¶ä¸è¯¥å‘ç”Ÿï¼‰\nç”¨ recoverï¼šåªåœ¨è¾¹ç•Œå±‚å…œåº•ï¼Œé¿å…å•ä¸ªè¯·æ±‚&#x2F;ä»»åŠ¡æŠŠæ•´ä¸ªè¿›ç¨‹æ‰“æŒ‚ï¼ŒåŒæ—¶ä¿ç•™æ—¥å¿—å’Œå †æ ˆï¼Œä¾¿äºä¿® bug\n\n8. å°ç»“\nrecover å¿…é¡»åœ¨ defer é‡Œæ‰æœ‰æ•ˆ\nrecover åªèƒ½æ•è·åŒä¸€ goroutine çš„ panic\nrecover çš„æ­£ç¡®ä»·å€¼ï¼šå…œåº•ã€é˜²å´©æºƒã€æ‰“æ—¥å¿—ã€ä¿ç•™å †æ ˆã€è®©ç³»ç»Ÿå¯ç”¨\næ—¥å¸¸ä¸šåŠ¡é”™è¯¯å¤„ç†ï¼šä¼˜å…ˆ errorï¼Œä¸è¦é  panic/recover å½“â€œå¼‚å¸¸æœºåˆ¶â€\n\n","categories":["Go"],"tags":["Go","panic","recover","defer"]}]